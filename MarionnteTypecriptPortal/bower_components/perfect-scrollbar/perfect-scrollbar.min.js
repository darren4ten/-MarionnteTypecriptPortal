/* Copyright (c) 2012, 2014 Hyunje Alex Jun and other contributors
 * Licensed under the MIT License
 */
!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){"use strict";function int(x){return"string"==typeof x?parseInt(x,10):~~x}var defaultSettings={wheelSpeed:1,wheelPropagation:!1,minScrollbarLength:null,maxScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1},incrementingId=0,eventClassFactory=function(){var id=incrementingId++;return function(eventName){var className=".perfect-scrollbar-"+id;return"undefined"==typeof eventName?className:eventName+className}};$.fn.perfectScrollbar=function(suppliedSettings,option){return this.each(function(){function updateScrollTop(currentTop,deltaY){var newTop=currentTop+deltaY,maxTop=containerHeight-scrollbarYHeight;scrollbarYTop=0>newTop?0:newTop>maxTop?maxTop:newTop;var scrollTop=int(scrollbarYTop*(contentHeight-containerHeight)/(containerHeight-scrollbarYHeight));$this.scrollTop(scrollTop)}function updateScrollLeft(currentLeft,deltaX){var newLeft=currentLeft+deltaX,maxLeft=containerWidth-scrollbarXWidth;scrollbarXLeft=0>newLeft?0:newLeft>maxLeft?maxLeft:newLeft;var scrollLeft=int(scrollbarXLeft*(contentWidth-containerWidth)/(containerWidth-scrollbarXWidth));$this.scrollLeft(scrollLeft)}function getThumbSize(thumbSize){return settings.minScrollbarLength&&(thumbSize=Math.max(thumbSize,settings.minScrollbarLength)),settings.maxScrollbarLength&&(thumbSize=Math.min(thumbSize,settings.maxScrollbarLength)),thumbSize}function updateCss(){var xRailOffset={width:containerWidth};xRailOffset.left=isRtl?$this.scrollLeft()+containerWidth-contentWidth:$this.scrollLeft(),isScrollbarXUsingBottom?xRailOffset.bottom=scrollbarXBottom-$this.scrollTop():xRailOffset.top=scrollbarXTop+$this.scrollTop(),$scrollbarXRail.css(xRailOffset);var railYOffset={top:$this.scrollTop(),height:containerHeight};isScrollbarYUsingRight?railYOffset.right=isRtl?contentWidth-$this.scrollLeft()-scrollbarYRight-$scrollbarY.outerWidth():scrollbarYRight-$this.scrollLeft():railYOffset.left=isRtl?$this.scrollLeft()+2*containerWidth-contentWidth-scrollbarYLeft-$scrollbarY.outerWidth():scrollbarYLeft+$this.scrollLeft(),$scrollbarYRail.css(railYOffset),$scrollbarX.css({left:scrollbarXLeft,width:scrollbarXWidth-railBorderXWidth}),$scrollbarY.css({top:scrollbarYTop,height:scrollbarYHeight-railBorderYWidth})}function updateGeometry(){$this.removeClass("ps-active-x"),$this.removeClass("ps-active-y");var firstChild=$this.find(">:first-child");firstChild.css({height:"auto",width:"auto"}),containerWidth=settings.includePadding?$this.innerWidth():$this.width(),containerHeight=settings.includePadding?$this.innerHeight():$this.height(),contentWidth=$this.prop("scrollWidth"),contentHeight=$this.prop("scrollHeight"),!settings.suppressScrollX&&containerWidth+settings.scrollXMarginOffset<contentWidth?(scrollbarXActive=!0,scrollbarXWidth=getThumbSize(int(containerWidth*containerWidth/contentWidth)),scrollbarXLeft=int($this.scrollLeft()*(containerWidth-scrollbarXWidth)/(contentWidth-containerWidth))):(scrollbarXActive=!1,scrollbarXWidth=0,scrollbarXLeft=0,$this.scrollLeft(0)),!settings.suppressScrollY&&containerHeight+settings.scrollYMarginOffset<contentHeight?(scrollbarYActive=!0,scrollbarYHeight=getThumbSize(int(containerHeight*containerHeight/contentHeight)),scrollbarYTop=int($this.scrollTop()*(containerHeight-scrollbarYHeight)/(contentHeight-containerHeight))):(scrollbarYActive=!1,scrollbarYHeight=0,scrollbarYTop=0,$this.scrollTop(0)),scrollbarXLeft>=containerWidth-scrollbarXWidth&&(scrollbarXLeft=containerWidth-scrollbarXWidth),scrollbarYTop>=containerHeight-scrollbarYHeight&&(scrollbarYTop=containerHeight-scrollbarYHeight),updateCss(),scrollbarXActive&&($this.addClass("ps-active-x"),firstChild.height(firstChild.height()-$this.find(".ps-scrollbar-x-rail").height())),scrollbarYActive&&($this.addClass("ps-active-y"),firstChild.width(firstChild.width()-$this.find(".ps-scrollbar-y-rail").width()))}function bindMouseScrollXHandler(){var currentLeft,currentPageX,inScrolling=!1;$scrollbarX.bind(eventClass("mousedown"),function(e){currentPageX=e.pageX,currentLeft=$scrollbarX.position().left,$scrollbarXRail.addClass("in-scrolling"),inScrolling=!0,e.stopPropagation(),e.preventDefault()}),$(ownerDocument).bind(eventClass("mousemove"),function(e){inScrolling&&(updateScrollLeft(currentLeft,e.pageX-currentPageX),updateGeometry(),e.stopPropagation(),e.preventDefault())}),$(ownerDocument).bind(eventClass("mouseup"),function(){inScrolling&&(inScrolling=!1,$scrollbarXRail.removeClass("in-scrolling"))}),currentLeft=currentPageX=null}function bindMouseScrollYHandler(){var currentTop,currentPageY,inScrolling=!1;$scrollbarY.bind(eventClass("mousedown"),function(e){currentPageY=e.pageY,currentTop=$scrollbarY.position().top,inScrolling=!0,$scrollbarYRail.addClass("in-scrolling"),e.stopPropagation(),e.preventDefault()}),$(ownerDocument).bind(eventClass("mousemove"),function(e){inScrolling&&(updateScrollTop(currentTop,e.pageY-currentPageY),updateGeometry(),e.stopPropagation(),e.preventDefault())}),$(ownerDocument).bind(eventClass("mouseup"),function(){inScrolling&&(inScrolling=!1,$scrollbarYRail.removeClass("in-scrolling"))}),currentTop=currentPageY=null}function shouldPreventDefault(deltaX,deltaY){var scrollTop=$this.scrollTop();if(0===deltaX){if(!scrollbarYActive)return!1;if(0===scrollTop&&deltaY>0||scrollTop>=contentHeight-containerHeight&&0>deltaY)return!settings.wheelPropagation}var scrollLeft=$this.scrollLeft();if(0===deltaY){if(!scrollbarXActive)return!1;if(0===scrollLeft&&0>deltaX||scrollLeft>=contentWidth-containerWidth&&deltaX>0)return!settings.wheelPropagation}return!0}function bindMouseWheelHandler(){function getDeltaFromEvent(e){var deltaX=e.originalEvent.deltaX,deltaY=-1*e.originalEvent.deltaY;return("undefined"==typeof deltaX||"undefined"==typeof deltaY)&&(deltaX=-1*e.originalEvent.wheelDeltaX/6,deltaY=e.originalEvent.wheelDeltaY/6),e.originalEvent.deltaMode&&1===e.originalEvent.deltaMode&&(deltaX*=10,deltaY*=10),deltaX!==deltaX&&deltaY!==deltaY&&(deltaX=0,deltaY=e.originalEvent.wheelDelta),[deltaX,deltaY]}function mousewheelHandler(e){var delta=getDeltaFromEvent(e),deltaX=delta[0],deltaY=delta[1];shouldPrevent=!1,settings.useBothWheelAxes?scrollbarYActive&&!scrollbarXActive?($this.scrollTop(deltaY?$this.scrollTop()-deltaY*settings.wheelSpeed:$this.scrollTop()+deltaX*settings.wheelSpeed),shouldPrevent=!0):scrollbarXActive&&!scrollbarYActive&&($this.scrollLeft(deltaX?$this.scrollLeft()+deltaX*settings.wheelSpeed:$this.scrollLeft()-deltaY*settings.wheelSpeed),shouldPrevent=!0):($this.scrollTop($this.scrollTop()-deltaY*settings.wheelSpeed),$this.scrollLeft($this.scrollLeft()+deltaX*settings.wheelSpeed)),updateGeometry(),shouldPrevent=shouldPrevent||shouldPreventDefault(deltaX,deltaY),shouldPrevent&&(e.stopPropagation(),e.preventDefault())}var shouldPrevent=!1;"undefined"!=typeof window.onwheel?$this.bind(eventClass("wheel"),mousewheelHandler):"undefined"!=typeof window.onmousewheel&&$this.bind(eventClass("mousewheel"),mousewheelHandler)}function bindKeyboardHandler(){var hovered=!1;$this.bind(eventClass("mouseenter"),function(){hovered=!0}),$this.bind(eventClass("mouseleave"),function(){hovered=!1});var shouldPrevent=!1;$(ownerDocument).bind(eventClass("keydown"),function(e){if((!e.isDefaultPrevented||!e.isDefaultPrevented())&&hovered){for(var activeElement=document.activeElement?document.activeElement:ownerDocument.activeElement;activeElement.shadowRoot;)activeElement=activeElement.shadowRoot.activeElement;if(!$(activeElement).is(":input,[contenteditable]")){var deltaX=0,deltaY=0;switch(e.which){case 37:deltaX=-30;break;case 38:deltaY=30;break;case 39:deltaX=30;break;case 40:deltaY=-30;break;case 33:deltaY=90;break;case 32:case 34:deltaY=-90;break;case 35:deltaY=e.ctrlKey?-contentHeight:-containerHeight;break;case 36:deltaY=e.ctrlKey?$this.scrollTop():containerHeight;break;default:return}$this.scrollTop($this.scrollTop()-deltaY),$this.scrollLeft($this.scrollLeft()+deltaX),shouldPrevent=shouldPreventDefault(deltaX,deltaY),shouldPrevent&&e.preventDefault()}}})}function bindRailClickHandler(){function stopPropagation(e){e.stopPropagation()}$scrollbarY.bind(eventClass("click"),stopPropagation),$scrollbarYRail.bind(eventClass("click"),function(e){var halfOfScrollbarLength=int(scrollbarYHeight/2),positionTop=e.pageY-$scrollbarYRail.offset().top-halfOfScrollbarLength,maxPositionTop=containerHeight-scrollbarYHeight,positionRatio=positionTop/maxPositionTop;0>positionRatio?positionRatio=0:positionRatio>1&&(positionRatio=1),$this.scrollTop((contentHeight-containerHeight)*positionRatio)}),$scrollbarX.bind(eventClass("click"),stopPropagation),$scrollbarXRail.bind(eventClass("click"),function(e){var halfOfScrollbarLength=int(scrollbarXWidth/2),positionLeft=e.pageX-$scrollbarXRail.offset().left-halfOfScrollbarLength,maxPositionLeft=containerWidth-scrollbarXWidth,positionRatio=positionLeft/maxPositionLeft;0>positionRatio?positionRatio=0:positionRatio>1&&(positionRatio=1),$this.scrollLeft((contentWidth-containerWidth)*positionRatio)})}function bindSelectionHandler(){function getRangeNode(){var selection=window.getSelection?window.getSelection():document.getSlection?document.getSlection():{rangeCount:0};return 0===selection.rangeCount?null:selection.getRangeAt(0).commonAncestorContainer}function startScrolling(){scrollingLoop||(scrollingLoop=setInterval(function(){return isPluginAlive()?($this.scrollTop($this.scrollTop()+scrollDiff.top),$this.scrollLeft($this.scrollLeft()+scrollDiff.left),void updateGeometry()):void clearInterval(scrollingLoop)},50))}function stopScrolling(){scrollingLoop&&(clearInterval(scrollingLoop),scrollingLoop=null),$scrollbarXRail.removeClass("in-scrolling"),$scrollbarYRail.removeClass("in-scrolling")}var scrollingLoop=null,scrollDiff={top:0,left:0},isSelected=!1;$(ownerDocument).bind(eventClass("selectionchange"),function(){$.contains($this[0],getRangeNode())?isSelected=!0:(isSelected=!1,stopScrolling())}),$(window).bind(eventClass("mouseup"),function(){isSelected&&(isSelected=!1,stopScrolling())}),$(window).bind(eventClass("mousemove"),function(e){if(isSelected){var mousePosition={x:e.pageX,y:e.pageY},containerOffset=$this.offset(),containerGeometry={left:containerOffset.left,right:containerOffset.left+$this.outerWidth(),top:containerOffset.top,bottom:containerOffset.top+$this.outerHeight()};mousePosition.x<containerGeometry.left+3?(scrollDiff.left=-5,$scrollbarXRail.addClass("in-scrolling")):mousePosition.x>containerGeometry.right-3?(scrollDiff.left=5,$scrollbarXRail.addClass("in-scrolling")):scrollDiff.left=0,mousePosition.y<containerGeometry.top+3?(scrollDiff.top=containerGeometry.top+3-mousePosition.y<5?-5:-20,$scrollbarYRail.addClass("in-scrolling")):mousePosition.y>containerGeometry.bottom-3?(scrollDiff.top=mousePosition.y-containerGeometry.bottom+3<5?5:20,$scrollbarYRail.addClass("in-scrolling")):scrollDiff.top=0,0===scrollDiff.top&&0===scrollDiff.left?stopScrolling():startScrolling()}})}function bindTouchHandler(supportsTouch,supportsIePointer){function applyTouchMove(differenceX,differenceY){$this.scrollTop($this.scrollTop()-differenceY),$this.scrollLeft($this.scrollLeft()-differenceX),updateGeometry()}function globalTouchStart(){inGlobalTouch=!0}function globalTouchEnd(){inGlobalTouch=!1}function getTouch(e){return e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e.originalEvent}function shouldHandle(e){var event=e.originalEvent;return event.targetTouches&&1===event.targetTouches.length?!0:event.pointerType&&"mouse"!==event.pointerType&&event.pointerType!==event.MSPOINTER_TYPE_MOUSE?!0:!1}function touchStart(e){if(shouldHandle(e)){inLocalTouch=!0;var touch=getTouch(e);startOffset.pageX=touch.pageX,startOffset.pageY=touch.pageY,startTime=(new Date).getTime(),null!==easingLoop&&clearInterval(easingLoop),e.stopPropagation()}}function touchMove(e){if(!inGlobalTouch&&inLocalTouch&&shouldHandle(e)){var touch=getTouch(e),currentOffset={pageX:touch.pageX,pageY:touch.pageY},differenceX=currentOffset.pageX-startOffset.pageX,differenceY=currentOffset.pageY-startOffset.pageY;applyTouchMove(differenceX,differenceY),startOffset=currentOffset;var currentTime=(new Date).getTime(),timeGap=currentTime-startTime;timeGap>0&&(speed.x=differenceX/timeGap,speed.y=differenceY/timeGap,startTime=currentTime),e.stopPropagation(),e.preventDefault()}}function touchEnd(){!inGlobalTouch&&inLocalTouch&&(inLocalTouch=!1,clearInterval(easingLoop),easingLoop=setInterval(function(){return isPluginAlive()?Math.abs(speed.x)<.01&&Math.abs(speed.y)<.01?void clearInterval(easingLoop):(applyTouchMove(30*speed.x,30*speed.y),speed.x*=.8,void(speed.y*=.8)):void clearInterval(easingLoop)},10))}var startOffset={},startTime=0,speed={},easingLoop=null,inGlobalTouch=!1,inLocalTouch=!1;supportsTouch&&($(window).bind(eventClass("touchstart"),globalTouchStart),$(window).bind(eventClass("touchend"),globalTouchEnd),$this.bind(eventClass("touchstart"),touchStart),$this.bind(eventClass("touchmove"),touchMove),$this.bind(eventClass("touchend"),touchEnd)),supportsIePointer&&(window.PointerEvent?($(window).bind(eventClass("pointerdown"),globalTouchStart),$(window).bind(eventClass("pointerup"),globalTouchEnd),$this.bind(eventClass("pointerdown"),touchStart),$this.bind(eventClass("pointermove"),touchMove),$this.bind(eventClass("pointerup"),touchEnd)):window.MSPointerEvent&&($(window).bind(eventClass("MSPointerDown"),globalTouchStart),$(window).bind(eventClass("MSPointerUp"),globalTouchEnd),$this.bind(eventClass("MSPointerDown"),touchStart),$this.bind(eventClass("MSPointerMove"),touchMove),$this.bind(eventClass("MSPointerUp"),touchEnd)))}function bindScrollHandler(){$this.bind(eventClass("scroll"),function(){updateGeometry()})}function destroy(){$this.unbind(eventClass()),$(window).unbind(eventClass()),$(ownerDocument).unbind(eventClass()),$this.data("perfect-scrollbar",null),$this.data("perfect-scrollbar-update",null),$this.data("perfect-scrollbar-destroy",null),$scrollbarX.remove(),$scrollbarY.remove(),$scrollbarXRail.remove(),$scrollbarYRail.remove(),$this=$scrollbarXRail=$scrollbarYRail=$scrollbarX=$scrollbarY=scrollbarXActive=scrollbarYActive=containerWidth=containerHeight=contentWidth=contentHeight=scrollbarXWidth=scrollbarXLeft=scrollbarXBottom=isScrollbarXUsingBottom=scrollbarXTop=scrollbarYHeight=scrollbarYTop=scrollbarYRight=isScrollbarYUsingRight=scrollbarYLeft=isRtl=eventClass=null}function initialize(){updateGeometry(),bindScrollHandler(),bindMouseScrollXHandler(),bindMouseScrollYHandler(),bindRailClickHandler(),bindSelectionHandler(),bindMouseWheelHandler(),(supportsTouch||supportsIePointer)&&bindTouchHandler(supportsTouch,supportsIePointer),settings.useKeyboard&&bindKeyboardHandler(),$this.data("perfect-scrollbar",$this),$this.data("perfect-scrollbar-update",updateGeometry),$this.data("perfect-scrollbar-destroy",destroy)}var settings=$.extend(!0,{},defaultSettings),$this=$(this),isPluginAlive=function(){return!!$this};if("object"==typeof suppliedSettings?$.extend(!0,settings,suppliedSettings):option=suppliedSettings,"update"===option)return $this.data("perfect-scrollbar-update")&&$this.data("perfect-scrollbar-update")(),$this;if("destroy"===option)return $this.data("perfect-scrollbar-destroy")&&$this.data("perfect-scrollbar-destroy")(),$this;if($this.data("perfect-scrollbar"))return $this.data("perfect-scrollbar");$this.addClass("ps-container");var containerWidth,containerHeight,contentWidth,contentHeight,scrollbarXActive,scrollbarXWidth,scrollbarXLeft,scrollbarYActive,scrollbarYHeight,scrollbarYTop,isRtl="rtl"===$this.css("direction"),eventClass=eventClassFactory(),ownerDocument=this.ownerDocument||document,$scrollbarXRail=$("<div class='ps-scrollbar-x-rail'>").appendTo($this),$scrollbarX=$("<div class='ps-scrollbar-x'>").appendTo($scrollbarXRail),scrollbarXBottom=int($scrollbarXRail.css("bottom")),isScrollbarXUsingBottom=scrollbarXBottom===scrollbarXBottom,scrollbarXTop=isScrollbarXUsingBottom?null:int($scrollbarXRail.css("top")),railBorderXWidth=int($scrollbarXRail.css("borderLeftWidth"))+int($scrollbarXRail.css("borderRightWidth")),$scrollbarYRail=$("<div class='ps-scrollbar-y-rail'>").appendTo($this),$scrollbarY=$("<div class='ps-scrollbar-y'>").appendTo($scrollbarYRail),scrollbarYRight=int($scrollbarYRail.css("right")),isScrollbarYUsingRight=scrollbarYRight===scrollbarYRight,scrollbarYLeft=isScrollbarYUsingRight?null:int($scrollbarYRail.css("left")),railBorderYWidth=int($scrollbarYRail.css("borderTopWidth"))+int($scrollbarYRail.css("borderBottomWidth")),supportsTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer=null!==window.navigator.msMaxTouchPoints;return initialize(),$this})}});